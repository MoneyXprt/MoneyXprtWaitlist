"use strict";(()=>{var e={};e.id=172,e.ids=[172],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7204:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var i={};a.r(i),a.d(i,{POST:()=>c});var n=a(9303),r=a(8716),s=a(3131),o=a(7070),l=a(1528);async function c(e){let{input:t,wantNarrative:a}=await e.json(),i=(0,l.Wq)(t),n=(0,l.Nt)(t),r="";if(a&&process.env.OPENAI_API_KEY)try{let e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",temperature:.2,messages:[{role:"system",content:"You are a fiduciary-quality financial & tax planner for high-income W-2 clients. Be specific, actionable, and concise. U.S. tax context. Avoid medical/legal disclaimers."},{role:"user",content:`STRUCTURED INPUT (JSON):
${JSON.stringify({input:t,snapshot:n,ruleEngineBullets:i},null,2)}

TASK: Draft a personalized plan:
1) Executive summary
2) Cash flow & savings
3) Investments & allocation
4) Tax planning
5) Risk/insurance
6) Retirement trajectory
7) 90-day checklist`}]})}),a=await e.json();r=a?.choices?.[0]?.message?.content??""}catch{}return o.NextResponse.json({recommendations:i,snapshot:n,narrative:r})}let d=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/plan/route",pathname:"/api/plan",filename:"route",bundlePath:"app/api/plan/route"},resolvedPagePath:"/Users/ianjoachim/Documents/GitHub/MoneyXprt/app/api/plan/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:h}=d,m="/api/plan/route";function g(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},1528:(e,t,a)=>{a.d(t,{Nt:()=>o,Wq:()=>l});let i=e=>"number"==typeof e&&isFinite(e)?e:0,n=(...e)=>e.reduce((e,t)=>e+i(t),0),r=e=>e.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}),s={single:14600,married_joint:29200,married_separate:14600,head:21900};function o(e){let t=n(e.salary,e.bonus,e.selfEmployment,e.rsuVesting,e.k1Active,e.k1Passive,e.otherIncome,e.rentNOI),a=12*i(e.fixedMonthlySpend)+12*i(e.lifestyleMonthlySpend),r=Math.max(0,t-a),s=(e.properties||[]).reduce((e,t)=>e+(i(t.estimatedValue)-i(t.mortgageBalance)),0),o=i(e.alts?.privateEquityVC)+i(e.alts?.collectibles)+i(e.alts?.other),l=n(e.cash,e.brokerage,e.retirement,e.hsa,e.crypto,s,o),c=n(e.mortgageDebt,e.studentLoans,e.autoLoans,e.creditCards,e.otherDebt),d=Math.max(3,i(e.emergencyFundMonths)),u=Math.max(1e3,i(e.fixedMonthlySpend)+i(e.lifestyleMonthlySpend)),p=u*d,h=u>0?i(e.cash)/u:0,m=p>0?Math.min(100,i(e.cash)/p*100):0;return{grossIncome:t,spendAnnual:a,impliedSavings:r,savingsRate:t>0?r/t*100:0,totalAssets:l,totalDebts:c,netWorth:l-c,ef:{targetEFMonths:d,monthlyBurn:u,efTarget:p,efCoverageMonths:h,efPct:m}}}function l(e){let t=e.discovery||{},a=(Array.isArray(e.goals5y)?e.goals5y:t.goals5)||[],n=(Array.isArray(e.goals20y)?e.goals20y:t.goals20)||[],l=e.freedomDef??t.freedom??"",c=Number.isFinite(e.confidence)?e.confidence:t.confidence??5,{grossIncome:d,spendAnnual:u,impliedSavings:p,savingsRate:h,netWorth:m}=o(e),g=s[e.filingStatus]??s.single,y=!!e.itemizeLikely,f=d>23e4&&"married_joint"===e.filingStatus||d>146e3&&"married_joint"!==e.filingStatus,v=[c>=8?"You’re confident—lean into compounding, while covering tail risks.":c<=4?"Since confidence is lower, bias to liquidity and resilience as we build momentum.":"Solid. We’ll balance growth with safety and cash flexibility.",`Snapshot: income ${r(d)}/yr; spend ${r(u)}/yr ⇒ implied savings ${r(p)} (${Math.round(h)}%). Net worth ${r(m)}.`],{ef:b}=o(e),x=Math.max(0,b.efTarget-i(e.cash));if(x>0?v.push(`Raise emergency fund to ~${b.targetEFMonths} months (${r(b.efTarget)}). Autotransfer ~${r(Math.ceil(x/12))}/mo to HYSA/T-bills.`):v.push(`Emergency fund ok (~${b.targetEFMonths} months). Keep it in HYSA/T-bill ladder for yield without losing liquidity.`),h<20){let e=Math.ceil((.2*d-p)/12);v.push(e>0?`Increase savings rate toward 20–30%: bump automated transfers by ~${r(e)}/mo (pay-yourself-first).`:`Increase savings rate toward 20–30% via automatic bumps after raises/bonuses.`)}else h>=30&&v.push(`Excellent savings discipline (~${Math.round(h)}%). Set a 1% auto-increase each year.`);let A=Math.max(0,23e3-Math.min(23e3,i(e.retirement)));if(A>0&&v.push(`If not already maxing, target employee 401(k) limit (~${r(23e3)}). Increase payroll deferrals by ~${r(Math.ceil(A/12))}/mo.`),v.push("Max tax-advantaged space: 401(k)/403(b), IRA/backdoor Roth (if needed), HSA if eligible."),f&&!e.usingRothBackdoor&&v.push("Income likely above direct Roth limits; consider a backdoor Roth (watch the pro-rata rule)."),e.usingMegaBackdoor&&v.push(`Using a mega-backdoor Roth—great. Confirm plan rules and avoid after-tax leakage.`),i(e.rsuVesting)>0){let t=.12999999999999998*i(e.rsuVesting);v.push(t>0?`RSUs: plans often withhold ~${Math.round(22)}%. At your bracket, set aside ~${r(t)} more across vests. Consider 10b5-1 and diversify concentration.`:"RSUs: verify withholding and consider a 10b5-1/diversify plan to manage risk and taxes.")}if(e.creditCards>0&&v.push("Attack credit cards first (avalanche). Automate extra above minimums until paid off."),e.studentLoans+e.autoLoans>0&&v.push("After high-interest debt, target student/auto loans while keeping retirement contributions on track."),v.push("If mortgage rate > your safe after-tax yield, add modest extra principal payments after savings goals are met."),(y||e.charitableInclination)&&v.push(`Itemized vs standard: compare to ~${r(g)} annually (SALT cap applies). Consider charitable “bunching” or a DAF in high-income years.`),e.hasDisability||v.push("Add long-term disability insurance (top income-protection priority)."),e.hasTermLife||v.push(`If others rely on your income, add term life (often 20–30\xd7 annual expenses).`),e.hasUmbrella||v.push(`Add a $1–$2M umbrella liability policy; it’s inexpensive and high impact.`),e.concentrationRisk&&v.push("Reduce concentration risk via target weights and scheduled auto-sells on any excess."),e.targetRetireIncomeMonthly>0){let t=12*i(e.targetRetireIncomeMonthly);v.push(`Retirement income target ~${r(t)}/yr ⇒ long-run portfolio ~${r(t/.04)} (4% proxy). Adjust for pensions, rentals, or early retirement.`)}e.hasWillOrTrust?v.push(`Review will/trust every 3–5 years and after major life events. Add POA/healthcare directives.`):v.push("Create a will and (if appropriate) a revocable living trust. Add POA/healthcare directives.");let S=a.filter(Boolean).slice(0,3),M=n.filter(Boolean).slice(0,3);return S.length&&v.push(`Near-term goals: ${S.join(" \xb7 ")}.`),M.length&&v.push(`Long-term goals: ${M.join(" \xb7 ")}.`),l&&v.push(`“Financial freedom” (your words): ${l}`),v.push("Set a 12-month roadmap: automate transfers, schedule quarterly reviews, and rebalance annually."),v}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[948,972],()=>a(7204));module.exports=i})();